### 目次 {ignore}

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [基本的な使い方](#基本的な使い方)
  - [ファイル構成](#ファイル構成)
  - [開き方](#開き方)
  - [プロットの仕方](#プロットの仕方)
  - [地図タイルの選択](#地図タイルの選択)
  - [プロットし直す(オプションを変更して描画し直す)](#プロットし直すオプションを変更して描画し直す)
- [プロットのオプションについて](#プロットのオプションについて)
  - [カラーバー最小値/最大値](#カラーバー最小値最大値)
  - [描画点の大きさ](#描画点の大きさ)
  - [描画閾値](#描画閾値)
  - [NaNの点を描画](#nanの点を描画)
  - [マップの透明度](#マップの透明度)
  - [ヒートマップテーマの選択](#ヒートマップテーマの選択)
  - [ヒートマップの向き](#ヒートマップの向き)
  - [列の選択](#列の選択)
  - [電力とノイズの差に対する描画の有無](#電力とノイズの差に対する描画の有無)
- [その他](#その他)
  - [描画点の詳細](#描画点の詳細)
  - [初期位置へ戻る](#初期位置へ戻る)
  - [プロットしたものを別HTMLへ出力する](#プロットしたものを別htmlへ出力する)
  - [用意するCSVについて](#用意するcsvについて)

<!-- /code_chunk_output -->

<div style="page-break-before:always"></div>

# 基本的な使い方

## ファイル構成

```
/フォルダ/
    │
    ├ index.html
    │
    ├ outputHTML.js
    │
    └ style.css
```

## 開き方

エクスプローラーなどで, `index.html`を任意のブラウザで開きます.
ブラウザはChrome, Firefoxなどであれば基本的に問題ないと思います.
(一方, **InternetExplorer**や**Microsoft Edge**などは動作がうまく行かない場合があります.)

## プロットの仕方

htmlを開くと, 以下のようになると思います.
(一面灰色ですが, 誤動作ではないです.)

@import "./img/01_open.png" {width=60%}

このとき, 左上の「**プロットする**」をクリックします.
そうすると, 以下のように「プロット時のオプション選択」のモーダルウィンドウが開きます.
(オプション項目は下の方にもあるのでスクロールしてください.)

@import "./img/02_plot-option.png" {width=60%}

こちらでは「描画するファイルの選択」, 「描画時のオプション」を選択することができます.
まず最初に描画するファイルを選択していきます. 描画できるファイル形式は**CSVファイルのみ**です(詳しくは[こちら](#用意するcsvについて)).

まず, 「**ファイルを選択**」をクリックしましょう.
そうすると以下のようにファイル選択のウィンドウが表示されるので, 対象のCSVファイルを選択してください.
(他のオプションの詳細については[こちら](#プロットのオプションについて)に記述します)

@import "./img/03_select-file.png" {width=60%}

CSVファイルが選択できると, カラムの選択が可能になります.

@import "./img/04_edit-option.png" {width=60%}

「緯度の列」「経度の列」「電力の列」を選択します.

@import "./img/05_plot-point.png" {width=60%}

必須項目を全て埋めると, 「プロットする」ボタンがクリック可能になります. 
それでは「プロットする」ボタンをクリックしましょう.

@import "./img/06_plotted.png" {width=60%}

このようにプロットされます. 以上でプロットは終了です. 
地図が無いと寂しさがすごいので, 次に地図タイルを選択していきます.

## 地図タイルの選択

右上の四角にマウスを合わせると, 以下のように選択できる地図タイルの一覧が表示されます.

@import "./img/07_select-tile.png" {width=60%}

その後, 利用したいタイルをクリックすると, そのタイルで描画が行われます.

@import "./img/08_selected-tile.png" {width=60%}

また, 地図タイルは複数選択することができます. これはマップが透明度を持っていないとあまり意味がありません.

そのため, 再度右上の「プロットする」を選択し, プロットのオプション「マップの透明度」のスライダーを左の方へ移動させてみましょう.

@import "./img/09_change-opacity.png" {width=60%}

できたら, 「プロットする」を選択し, 地図タイルを複数選択してみましょう.
以下のように複数のタイルが重なっていることがわかります.

<div style="page-break-before:always"></div>

@import "./img/10_selected-tiles.png" {width=60%}


<div class="memo">
<div class="box-title">地図タイルが選択できない？</div>

一部選択ができない場合がありますが, 地図タイルによって描画のズーム倍率が決まっており選択できないだけなので, ズーム倍率を変えると描画できるようになります.

特に「国土地理院:白地図」「国土地理院:色別標高図」は高いズーム倍率に対応していないので, 選択できない場合があります.

</div>

## プロットし直す(オプションを変更して描画し直す)

一度プロットした後, 左上の「プロットする」ボタンを押し, 再度プロットすると, 先ほどまでのプロット内容をクリアして, プロットをやり直すことができます.
逆に言えば, 複数CSVファイルの同時プロットはできません.

もし複数ファイルのプロットをしたい場合は, CSVを複合し, 1つにしたものを利用してください.

<div style="page-break-before:always"></div>

# プロットのオプションについて

プロットする際に選択できるオプションについてです. 以下に概要を記します.

| オプション | 概要 | 必須 |
| :-: | :-: | :-: |
| [カラーバー最小値](#カラーバー最小値最大値) | ヒートマップの下限値 | ○ |
| [カラーバー最大値](#カラーバー最小値最大値) | ヒートマップの上限値 | ○ |
| [描画点の大きさ](#描画点の大きさ) | 描画点の大きさを決めます | ○ |
| [描画閾値](#描画閾値) | この値を超える値を持つ点のみ描画します | × |
| [NaNの点を描画](#nanの点を描画) | 値のない点を描画するかを決めます | - |
| マップの透明度 | 背景の地図タイルの透明度を選択します | - |
| ヒートマップテーマの選択 | ヒートマップの色テーマを変更できます | - |
| ヒートマップの向き | カラーバーのグラデーション方向を選べます | - |
|  |  |  |
| 緯度の列 | CSVのカラムのうち, 緯度の列を選択します | ○ |
| 経度の列 | CSVのカラムのうち, 経度の列を選択します | ○ |
| 電力の列 | CSVのカラムのうち, 電力の列を選択します | ○ |
|  |  |  |
| ノイズの列 | CSVのカラムのうち, ノイズの列を選択します | × |
| 信号ノイズ差 | 信号とノイズの差がこの値以上だと描画されます | △ |

## カラーバー最小値/最大値

@import "./img/option00_cbar-mm.png" {width=70%}

ヒートマップの上限/下限を決めます. つまり以下の部分の選択です.

@import "./img/cbar-mm.png" {width=40%}

初期値は「最小値:-130」, 「最大値:-90」になっています.

## 描画点の大きさ

@import "./img/option01_radius.png" {width=70%}

プロット点の大きさ(半径)を選択します.
以下のように大きさが変わります.

@import "./img/radius.png" {width=50%}

初期値は`15`です.

## 描画閾値

@import "./img/option02_threshold.png" {width=70%}

いくつ以上の値を保持する点のみを描画するかを選択できます.
値を入れなかった場合は全点を描画します.

@import "./img/threshold.png" {width=60%}

## NaNの点を描画

@import "./img/option03_NaN.png" {width=70%}

値の入っていない地点について, 描画するかどうかを決めます.
四角いボタンをクリックすると「しない」/「する」がトグルします.
ちなみに, NaNの地点は黒い点で描画されます.

@import "./img/NaN.png" {width=70%}

初期値は`する`です.

## マップの透明度

@import "./img/option04_opacity.png" {width=70%}

背景に表示するマップの透明度を選択します.
+ スライダーを左いっぱいに持ってくると, ほぼ透明になり
+ スライダーを右いっぱいに持ってくると, 完全不透明になります.

複数の地図タイルを選択したい場合や, より描画点を目立たせたい場合に, この値を低く設定しましょう.

@import "./img/opacity.png" {width=60%}

初期値は`完全不透明(右いっぱい)`です.


## ヒートマップテーマの選択

@import "./img/option05_theme.png" {width=70%}

ヒートマップに利用するカラーテーマを選択します.
使いそうなものをいくつか用意したので, その中から選択してください.
以下に見本を貼っておきます.

@import "./img/theme-ver01.png" {width=60%}
@import "./img/theme-ver02.png" {width=60%}

初期値は`jet`です.

## ヒートマップの向き

@import "./img/option06_reverse.png" {width=70%}

カラーバーのグラデーション方向を選べます.
四角いボタンをクリックすると「順方向」/「逆方向」がトグルします.

@import "./img/reverse.png" {width=60%}

初期値は`順方向`です.

## 列の選択

@import "./img/option07_column.png" {width=70%}

データを選択後, 選択できるようになります.

+ 緯度の列 : CSVのカラムのうち, 緯度の列を選択します.
    ヘッダーに`Latitude`があった場合, 自動でセットされます.
+ 経度の列 : CSVのカラムのうち, 経度の列を選択します.
    ヘッダーに`Longitude`があった場合, 自動でセットされます.
+ 電力の列 : CSVのカラムのうち, 電力の列を選択します.
    (描画したい値なら, 電力でなくともなんでも大丈夫です)

## 電力とノイズの差に対する描画の有無

@import "./img/option08_SN-threshold.png" {width=70%}

「ノイズの列」はデータを選択後, 選択できるようになります.
また, 「ノイズの列」を選択すると, 「信号ノイズ差」欄の入力ができるようになります.
この部分を埋めていくと, $電力-ノイズ\ge信号ノイズ差$を満たす点のみ, 描画されるようになります.


「ノイズの列」は必須項目ではないので, 必要ない場合はスルーしてください.
また「信号ノイズ差」は「ノイズの列」を選択した際は必須項目となります.

<div style="page-break-before:always"></div>

# その他

## 描画点の詳細

描画した点にマウスカーソルを合わせると, 以下の情報がポップアップで表示されます.

+ 緯度
+ 経度
+ 描画に利用した値

@import "./img/12_hover-point.png" {width=70%}

## 初期位置へ戻る

左上のオレンジ色のボタンをクリックすると, ズーム倍率はそのままで, 描画した点まで戻ります.

## プロットしたものを別HTMLへ出力する

左上の緑色のボタンをクリックすると, 現在の描画内容を他のHTMLへ出力し, ダウンロードすることができます. 出力したファイルは1ファイルで完結しているので, どこのフォルダに移動しても大丈夫です.

ちなみに出力したファイルをブラウザで開くと, 以下のようになります.
@import "./img/11_output-html.png" {width=70%}

内容は簡素になりますが, 「移動/拡大/縮小」や「地図タイルの変更」, 「ポップアップの表示」は可能です.

@import "./img/12_edit-output-html.png" {width=70%}

## 用意するCSVについて

入力データは`,`で区切られたデータ(CSV)が必要です.
また, 後からカラムを選択するため, ヘッダーが記載されている必要があります.
そして, データの内容として, 「緯度」「経度」「描画したい値」がどこかの列に含まれていれば, どのようなデータでも描画できます.

(以下は内容の例)

@import "./img/ex_csv_data.png" {width="80%"}
